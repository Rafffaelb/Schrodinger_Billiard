CC = g++
CXXFLAGS = -std=c++11 -O3 -I. -Ieigen-3.4.0 -DNDEBUG
EIGEN_DIR = eigen-3.4.0
EIGEN_VERSION = 3.4.0
EIGEN_URL = https://gitlab.com/libeigen/eigen/-/archive/$(EIGEN_VERSION)/eigen-$(EIGEN_VERSION).tar.bz2

# Source files
SRCS = main.cpp \
       src/WignerDyson_AbstractClass_cpp/WignerDyson.cpp \
       src/Orthogonal.cpp \
       src/Unitary.cpp \
       src/Symplectic.cpp \
       src/Quantum_chaotic_billiard.cpp \
       src/WignerDyson_AbstractClass_cpp/Run_Simulation_Conductance_Channels.cpp \
       src/WignerDyson_AbstractClass_cpp/Run_Simulation_Conductance_Gamma.cpp \
       src/WignerDyson_AbstractClass_cpp/Run_Simulation_Concurrence_Gamma.cpp \
       src/WignerDyson_AbstractClass_cpp/Run_Simulation_Bell_Parameter_Ress.cpp \
       src/WignerDyson_AbstractClass_cpp/Run_Simulation_Bell_Parameter_Gamma.cpp \
       src/WignerDyson_AbstractClass_cpp/Run_Simulation_Bell_Parameter_Fixed_Base.cpp \
       src/WignerDyson_AbstractClass_cpp/Run_Simulation_Conductance_Energy.cpp \
       src/WignerDyson_AbstractClass_cpp/Run_Simulation_Conductance_Energy_Gamma.cpp

OBJS = $(SRCS:.cpp=.o)
TARGET = WignerDyson

.PHONY: all clean clean-all eigen-download eigen-check

all: eigen-check $(TARGET)

eigen-check:
	@if [ ! -d "$(EIGEN_DIR)" ]; then \
		echo "Eigen library not found. Downloading..."; \
		make eigen-download; \
	fi

eigen-download:
	@if command -v wget > /dev/null 2>&1; then \
		wget -O eigen.tar.bz2 "$(EIGEN_URL)"; \
	elif command -v curl > /dev/null 2>&1; then \
		curl -L -o eigen.tar.bz2 "$(EIGEN_URL)"; \
	else \
		echo "Error: Neither wget nor curl found. Please install one of them."; \
		exit 1; \
	fi
	@if [ -f "eigen.tar.bz2" ]; then \
		tar -xjf eigen.tar.bz2; \
		rm -f eigen.tar.bz2; \
		echo "Eigen library successfully downloaded and extracted."; \
	else \
		echo "Error: Failed to download Eigen library"; \
		exit 1; \
	fi

$(TARGET): $(OBJS)
	$(CC) $(CXXFLAGS) -o $@ $^ -lm

%.o: %.cpp
	$(CC) $(CXXFLAGS) -c $< -o $@

clean:
	rm -f *.o src/*.o src/WignerDyson_AbstractClass_cpp/*.o $(TARGET)

clean-all: clean
	rm -rf $(EIGEN_DIR) $(TARGET)